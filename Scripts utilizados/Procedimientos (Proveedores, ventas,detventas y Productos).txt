--listar categoría
CREATE OR REPLACE PROCEDURE LISTAR_CATEGORIAS (cur OUT SYS_REFCURSOR) AS
BEGIN
    OPEN cur FOR SELECT
    "A1"."ID_CATEGORIA"     "ID_CATEGORIA",
    "A1"."NOMBRE_CATEGORIA" "NOMBRE_CATEGORIA"
FROM
    "SYSTEM"."CATEGORIAS" "A1";
END;

--insertar una categoría
CREATE OR REPLACE PROCEDURE INSERTAR_CATEGORIA(p_id NUMBER, p_nombre VARCHAR2) AS
BEGIN
    INSERT INTO CATEGORIAS (ID_CATEGORIA, NOMBRE_CATEGORIA) VALUES (p_id, p_nombre);
    COMMIT;
END;

--actualizar una categoría
CREATE OR REPLACE PROCEDURE ACTUALIZAR_CATEGORIA(p_id NUMBER, p_nombre VARCHAR2) AS
BEGIN
    UPDATE CATEGORIAS SET NOMBRE_CATEGORIA = p_nombre WHERE ID_CATEGORIA = p_id;
    COMMIT;
END;

--eliminar una categoría
CREATE OR REPLACE PROCEDURE ELIMINAR_CATEGORIA(p_id NUMBER) AS
BEGIN
    DELETE FROM CATEGORIAS WHERE ID_CATEGORIA = p_id;
    COMMIT;
END;


/***********Creacion de TABLAS**************/
-- TABLA PROVEEDORES
CREATE TABLE PROVEEDORES (
    ID_PROVEEDOR INT PRIMARY KEY,
    NOMBRE VARCHAR(255),
    TELEFONO VARCHAR(50),
    DIRECCION VARCHAR(255),
    CORREO VARCHAR(255)
);

-- TABLA EMPLEADOS
CREATE TABLE EMPLEADOS (
    ID_EMPLEADO INT PRIMARY KEY,
    NOMBRE VARCHAR(255),
    CARGO VARCHAR(255),
    TELEFONO VARCHAR(50),
    CORREO VARCHAR(255)
);

-- TABLA CATEGORIAS
CREATE TABLE CATEGORIAS (
    ID_CATEGORIA INT PRIMARY KEY,
    NOMBRE_CATEGORIA VARCHAR(255)
);

-- TABLA PRODUCTOS
CREATE TABLE PRODUCTOS (
    ID_PRODUCTO INT PRIMARY KEY,
    NOMBRE VARCHAR(255),
    DESCRIPCION VARCHAR(255),
    PRECIO DECIMAL(10, 2),
    STOCK INT,
    ID_CATEGORIA INT,
    FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIAS(ID_CATEGORIA)
);

-- TABLA CLIENTES
CREATE TABLE CLIENTES (
    ID_CLIENTE INT PRIMARY KEY,
    NOMBRE VARCHAR(255),
    TELEFONO VARCHAR(50),
    DIRECCION VARCHAR(255),
    CORREO VARCHAR(255)
);

-- TABLA VENTAS
CREATE TABLE VENTAS (
    ID_VENTA INT PRIMARY KEY,
    ID_CLIENTE INT,
    ID_EMPLEADO INT,
    FECHA_VENTA DATE,
    TOTAL DECIMAL(10, 2),
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTES(ID_CLIENTE),
    FOREIGN KEY (ID_EMPLEADO) REFERENCES EMPLEADOS(ID_EMPLEADO) -- CONEXIÓN CON EMPLEADOS
);

-- TABLA DETALLE_VENTAS
CREATE TABLE DETALLE_VENTAS (
    ID_DETALLE INT PRIMARY KEY,
    ID_VENTA INT,
    ID_PRODUCTO INT,
    CANTIDAD INT,
    SUBTOTAL DECIMAL(10, 2),
    FOREIGN KEY (ID_VENTA) REFERENCES VENTAS(ID_VENTA),
    FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTOS(ID_PRODUCTO)
);

-- TABLA COMPRAS
CREATE TABLE COMPRAS (
    ID_COMPRA INT PRIMARY KEY,
    ID_PROVEEDOR INT,
    FECHA_COMPRA DATE,
    TOTAL DECIMAL(10, 2),
    FOREIGN KEY (ID_PROVEEDOR) REFERENCES PROVEEDORES(ID_PROVEEDOR)
);
select * from Proveedores;

--//////////////////////////////////////////////////////////////////////////--

--Proveedores
CREATE OR REPLACE PROCEDURE LISTAR_PROVEEDORES (cur OUT SYS_REFCURSOR) AS
BEGIN
    OPEN cur FOR SELECT
        ID_PROVEEDOR,
        NOMBRE,
        TELEFONO,
        DIRECCION,
        CORREO
    FROM PROVEEDORES;
END;

CREATE OR REPLACE PROCEDURE INSERTAR_PROVEEDOR(
    p_id_proveedor NUMBER,
    p_nombre VARCHAR2,
    p_telefono VARCHAR2,
    p_direccion VARCHAR2,
    p_correo VARCHAR2
) AS
BEGIN
    INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO)
    VALUES (p_id_proveedor, p_nombre, p_telefono, p_direccion, p_correo);
    COMMIT;
END;

CREATE OR REPLACE PROCEDURE ACTUALIZAR_PROVEEDOR(
    p_id_proveedor NUMBER,
    p_nombre VARCHAR2,
    p_telefono VARCHAR2,
    p_direccion VARCHAR2,
    p_correo VARCHAR2
) AS
BEGIN
    UPDATE PROVEEDORES
    SET NOMBRE = p_nombre,
        TELEFONO = p_telefono,
        DIRECCION = p_direccion,
        CORREO = p_correo
    WHERE ID_PROVEEDOR = p_id_proveedor;
    COMMIT;
END;

CREATE OR REPLACE PROCEDURE ELIMINAR_PROVEEDOR(
    p_id_proveedor NUMBER
) AS
BEGIN
    DELETE FROM PROVEEDORES WHERE ID_PROVEEDOR = p_id_proveedor;
    COMMIT;
END;



--Ventas
CREATE OR REPLACE PROCEDURE LISTAR_VENTAS (cur OUT SYS_REFCURSOR) AS
BEGIN
    OPEN cur FOR SELECT
        ID_VENTA,
        ID_CLIENTE,
        ID_EMPLEADO,
        FECHA_VENTA,
        TOTAL
    FROM VENTAS;
END;

CREATE OR REPLACE PROCEDURE INSERTAR_VENTA(
    p_id_venta NUMBER,
    p_id_cliente NUMBER,
    p_id_empleado NUMBER,
    p_fecha_venta DATE,
    p_total DECIMAL
) AS
BEGIN
    INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL)
    VALUES (p_id_venta, p_id_cliente, p_id_empleado, p_fecha_venta, p_total);
    COMMIT;
END;

CREATE OR REPLACE PROCEDURE ACTUALIZAR_VENTA(
    p_id_venta NUMBER,
    p_id_cliente NUMBER,
    p_id_empleado NUMBER,
    p_fecha_venta DATE,
    p_total DECIMAL
) AS
BEGIN
    UPDATE VENTAS
    SET ID_CLIENTE = p_id_cliente,
        ID_EMPLEADO = p_id_empleado,
        FECHA_VENTA = p_fecha_venta,
        TOTAL = p_total
    WHERE ID_VENTA = p_id_venta;
    COMMIT;
END;

CREATE OR REPLACE PROCEDURE ELIMINAR_VENTA(
    p_id_venta NUMBER
) AS
BEGIN
    DELETE FROM VENTAS WHERE ID_VENTA = p_id_venta;
    COMMIT;
END;

CREATE OR REPLACE PROCEDURE INSERTAR_DETALLE_VENTA(
    p_id_detalle NUMBER,
    p_id_venta NUMBER,
    p_id_producto NUMBER,
    p_cantidad NUMBER,
    p_subtotal DECIMAL
) AS
BEGIN
    INSERT INTO DETALLE_VENTAS (ID_DETALLE, ID_VENTA, ID_PRODUCTO, CANTIDAD, SUBTOTAL)
    VALUES (p_id_detalle, p_id_venta, p_id_producto, p_cantidad, p_subtotal);
    COMMIT;
END;


--PRODUCTOS
CREATE OR REPLACE PROCEDURE INSERTAR_PRODUCTO(
    p_id_producto NUMBER,
    p_nombre VARCHAR2,
    p_descripcion VARCHAR2,
    p_precio DECIMAL,
    p_stock NUMBER,
    p_id_categoria NUMBER
) AS
BEGIN
    INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA)
    VALUES (p_id_producto, p_nombre, p_descripcion, p_precio, p_stock, p_id_categoria);
    COMMIT;
END;


CREATE OR REPLACE PROCEDURE LISTAR_PRODUCTOS (cur OUT SYS_REFCURSOR) AS
BEGIN
    OPEN cur FOR SELECT
        ID_PRODUCTO,
        NOMBRE,
        DESCRIPCION,
        PRECIO,
        STOCK,
        ID_CATEGORIA
    FROM PRODUCTOS;
END;

CREATE OR REPLACE PROCEDURE ACTUALIZAR_PRODUCTO(
    p_id_producto NUMBER,
    p_nombre VARCHAR2,
    p_descripcion VARCHAR2,
    p_precio DECIMAL,
    p_stock NUMBER,
    p_id_categoria NUMBER
) AS
BEGIN
    UPDATE PRODUCTOS
    SET NOMBRE = p_nombre,
        DESCRIPCION = p_descripcion,
        PRECIO = p_precio,
        STOCK = p_stock,
        ID_CATEGORIA = p_id_categoria
    WHERE ID_PRODUCTO = p_id_producto;
    COMMIT;
END;

CREATE OR REPLACE PROCEDURE ELIMINAR_PRODUCTO(
    p_id_producto NUMBER
) AS
BEGIN
    DELETE FROM PRODUCTOS WHERE ID_PRODUCTO = p_id_producto;
    COMMIT;
END;



--INSERTs Proveedores
INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (100, 'Los Angeles', '+506-1234-9878', 'Brava, Heredia', 'losangeles@hotmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (101, 'Total', '+506-1234-2888', 'Pavas, San Jose', 'total@htmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (102, 'Acosta', '+506-1234-7211', 'Santa Barbara, Heredia', 'acosta@hotmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (103, 'Murillo', '+506-1234-6521', 'Santa Barbara, Heredia', 'murillo@gmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (104, 'El Encuentro', '+506-1234-9019', 'San Isidro, Alajuela', 'elencuentro@hotmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (105, 'Matra', '+506-1234-6622', 'San Rafael, Alajuela', 'matra@gmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (106, 'Ramstac', '+506-1234-4759', 'Belen, Heredia', 'ramstac@gmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (107, 'La Bendicion', '+506-1234-5778', 'Turrialba, Cartago', 'labendicion@hotmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (108, 'Stanley', '+506-1234-5144', 'Zapote, San Jose', 'stanley@gmail.com');

INSERT INTO PROVEEDORES (ID_PROVEEDOR, NOMBRE, TELEFONO, DIRECCION, CORREO) 
VALUES (109, 'Bosch', '+506-1234-6161', 'Paraiso, Cartago', 'bosch@hotmail.com');


--Inserts Ventas
INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1001, 1, 1, TO_DATE('2024-05-11', 'YYYY-MM-DD'), 1500.51);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1002, 1, 1, TO_DATE('2024-10-27', 'YYYY-MM-DD'), 2000.19);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1003, 2, 1, TO_DATE('2024-11-15', 'YYYY-MM-DD'), 530.99);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1004, 2, 5, TO_DATE('2024-11-30', 'YYYY-MM-DD'), 1250.81);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1005, 4, 3, TO_DATE('2024-10-08', 'YYYY-MM-DD'), 725.44);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1006, 2, 1, TO_DATE('2024-09-27', 'YYYY-MM-DD'), 550.01);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1007, 4, 3, TO_DATE('2024-09-10', 'YYYY-MM-DD'), 1225.84);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1008, 1, 2, TO_DATE('2024-03-28', 'YYYY-MM-DD'), 1750.37);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1009, 2, 2, TO_DATE('2024-04-28', 'YYYY-MM-DD'), 1435.14);

INSERT INTO VENTAS (ID_VENTA, ID_CLIENTE, ID_EMPLEADO, FECHA_VENTA, TOTAL) 
VALUES (1010, 5, 4, TO_DATE('2024-07-02', 'YYYY-MM-DD'), 985.47);


--Insert Detalle ventas
INSERT INTO DETALLE_VENTAS (ID_DETALLE, ID_VENTA, ID_PRODUCTO, CANTIDAD, SUBTOTAL) 
VALUES (1, 1001, 1, 2, 300.00);

INSERT INTO DETALLE_VENTAS (ID_DETALLE, ID_VENTA, ID_PRODUCTO, CANTIDAD, SUBTOTAL) 
VALUES (2, 1001, 2, 1, 150.00);

INSERT INTO DETALLE_VENTAS (ID_DETALLE, ID_VENTA, ID_PRODUCTO, CANTIDAD, SUBTOTAL) 
VALUES (3, 1002, 3, 5, 750.00);


--iNSERT PRODUCTOS

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (1, 'Taladro', 'Herramienta electrica', 35769.11, 15, 1);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (2, 'Martillo', 'Clavar o demoler', 5400.1, 50, 2);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (3, 'Destornillador', 'Ajustar/desajustar tornillos', 3542.7, 43, 2);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (4, 'Cinta Metrica', 'Tomar medidas', 5235.38, 72, 2);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA)
VALUES (5, 'Llave inglesa ajustable', 'Ajustar tuercas o tornillos', 4825.67, 15, 2);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (6, 'Sierra', 'Herramienta electrica, cortar madera', 25965.89, 10, 1);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (7, 'Alicate', 'Cortar cables o sujetar cosas', 2981.57, 53, 2);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (8, 'Tenazas', 'Cortar o sujetar', 2685.23, 65, 2);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (9, 'Taype', 'Aislar cables', 3640.77, 30, 1);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (10, 'Tornillos de madera', 'Fijacion en madera', 50.64, 582, 4);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (11, 'Tornillo de metal', 'Fijacion en metal', 50.75, 564, 4);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (12, 'Clavos', 'Fijacion en madera', 40.59, 485, 4);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (13, 'Clavos de acero', 'Fijacion en cemento', 45.32, 633, 4);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (14, 'Tubo de PVC', 'Conducción de agua', 8999.66, 67, 3);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (15, 'Pala', 'Excavar, jardinería o mover tierra', 10625.21, 18, 5);

INSERT INTO PRODUCTOS (ID_PRODUCTO, NOMBRE, DESCRIPCION, PRECIO, STOCK, ID_CATEGORIA) 
VALUES (16, 'Carretillo', 'Transportar materiales', 32537.21, 15, 5);



--Insert categorias

INSERT INTO CATEGORIAS (ID_CATEGORIA, NOMBRE_CATEGORIA) 
VALUES (1, 'Heeramienta Electrica');

INSERT INTO CATEGORIAS (ID_CATEGORIA, NOMBRE_CATEGORIA) 
VALUES (2, 'Herramienta manual');

INSERT INTO CATEGORIAS (ID_CATEGORIA, NOMBRE_CATEGORIA) 
VALUES (3, 'Herramienta para agua');

INSERT INTO CATEGORIAS (ID_CATEGORIA, NOMBRE_CATEGORIA) 
VALUES (4, 'Materiales de Fijacion');

INSERT INTO CATEGORIAS (ID_CATEGORIA, NOMBRE_CATEGORIA) 
VALUES (5, 'Herramientas de excavacion o jardinería');
